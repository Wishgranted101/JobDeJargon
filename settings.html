<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - JobDeJargon Pro</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .settings-link {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
        }
        .settings-link:hover {
            background: var(--surface);
            color: var(--primary);
        }
        .settings-link.active {
            background: var(--primary);
            color: white;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1><a href="index.html" style="text-decoration: none; color: inherit;">JobDeJargon Pro</a></h1>
                </div>
                <nav class="nav">
                    <a href="index.html">Home</a>
                    <a href="job-analysis.html">Analyze Job</a>
                    <a href="dashboard.html">Dashboard</a>
                    <a href="settings.html">Settings</a>
                    <button onclick="logout()" class="btn-secondary" style="padding: 0.5rem 1rem;">Logout</button>
                </nav>
            </div>
        </div>
    </header>

    <main class="container" style="padding: 3rem 20px;">
        <h2 style="margin-bottom: 2rem;">Account Settings</h2>

        <div style="display: grid; grid-template-columns: 250px 1fr; gap: 2rem;">
            <div>
                <div class="card" style="padding: 1rem;">
                    <a href="#" class="settings-link active" onclick="return showSection('profile')">üë§ Profile</a>
                    <a href="#" class="settings-link" onclick="return showSection('subscription')">üí≥ Subscription</a>
                    <a href="#" class="settings-link" onclick="return showSection('preferences')">‚öôÔ∏è Preferences</a>
                    <a href="#" class="settings-link" onclick="return showSection('data')">üìä Data & Privacy</a>
                </div>
            </div>

            <div>
                <div id="profileSection" class="settings-section">
                    <div class="card">
                        <h3 style="margin-bottom: 1.5rem;">Profile Information</h3>
                        <form id="profileForm">
                            <div class="form-group">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullName" placeholder="Your name">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" disabled>
                                <small style="color: var(--text-secondary);">Contact support to change email</small>
                            </div>
                            <div class="form-group">
                                <label for="jobTitle">Current Job Title</label>
                                <input type="text" id="jobTitle" placeholder="e.g., Software Engineer">
                            </div>
                            <div class="form-group">
                                <label for="industry">Industry</label>
                                <select id="industry">
                                    <option>Technology</option>
                                    <option>Finance</option>
                                    <option>Healthcare</option>
                                    <option>Education</option>
                                    <option>Marketing</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-primary">Save Changes</button>
                        </form>
                    </div>
                </div>

                <div id="subscriptionSection" class="settings-section" style="display: none;">
                    <div class="card">
                        <h3 style="margin-bottom: 1.5rem;">Subscription Management</h3>
                        <div style="padding: 1.5rem; background: var(--surface); border-radius: 8px; margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                                <div>
                                    <h4>Free Plan</h4>
                                    <p style="color: var(--text-secondary); margin-top: 0.25rem;" id="creditsDisplay">Loading credits...</p>
                                </div>
                                <div>
                                    <a href="pro-features.html" class="btn-primary">Upgrade to Pro</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="preferencesSection" class="settings-section" style="display: none;">
                    <div class="card">
                        <h3 style="margin-bottom: 1.5rem;">Preferences</h3>
                        <div class="form-group">
                            <label>Default Personality</label>
                            <select id="defaultPersonality">
                                <option value="brutal-truth" selected>Brutal Truth Coach</option>
                                <option value="hr-insider">HR Insider</option>
                                <option value="friendly-mentor">Friendly Mentor</option>
                            </select>
                            <small style="color: var(--text-secondary);">Choose your preferred AI advisor style</small>
                        </div>
                        <button class="btn-primary" onclick="savePreferences()">Save Preferences</button>
                    </div>
                </div>

                <div id="dataSection" class="settings-section" style="display: none;">
                    <div class="card">
                        <h3 style="margin-bottom: 1.5rem;">Data & Privacy</h3>
                        <div style="margin-bottom: 2rem;">
                            <h4 style="margin-bottom: 0.5rem;">Export Your Data</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Download all your job analyses.</p>
                            <button class="btn-secondary">üì• Export All Data</button>
                        </div>
                        <div style="margin-bottom: 2rem;">
                            <h4 style="margin-bottom: 0.5rem;">Clear History</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Remove all saved analyses.</p>
                            <button class="btn-secondary" onclick="clearHistory()">üóëÔ∏è Clear All History</button>
                        </div>
                        <div style="padding: 1.5rem; background: #FEF2F2; border: 1px solid #FCA5A5; border-radius: 8px;">
                            <h4 style="margin-bottom: 0.5rem; color: var(--danger);">Danger Zone</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Once you delete your account, there is no going back.</p>
                            <button class="btn-danger" onclick="deleteAccount()">Delete Account</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="toast" class="toast"></div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>JobDeJargon Pro</h4>
                    <p>The honest co-pilot for job seekers.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- CRITICAL: Load Supabase and Auth BEFORE api.js -->
    <script src="js/supabase-client.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    
    <script>
        // ‚ö†Ô∏è AUTHENTICATION GUARD - Redirect if not logged in
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for Supabase to initialize
            setTimeout(() => {
                if (!isUserLoggedIn()) {
                    showToast('Please log in to access settings');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                } else {
                    // Load user data
                    loadUserSettings();
                }
            }, 500);
        });
        
        // Load user settings
        function loadUserSettings() {
            if (window.currentUser) {
                document.getElementById('email').value = window.currentUser.email || '';
                document.getElementById('fullName').value = window.currentUser.full_name || '';
                
                // Show credits
                const creditsText = `${window.currentUser.credits} credits remaining`;
                document.getElementById('creditsDisplay').textContent = creditsText;
            }
        }
        
        function showSection(sectionName) {
            document.querySelectorAll('.settings-section').forEach(section => section.style.display = 'none');
            document.querySelectorAll('.settings-link').forEach(link => link.classList.remove('active'));
            
            const sectionMap = {
                'profile': 'profileSection',
                'subscription': 'subscriptionSection',
                'preferences': 'preferencesSection',
                'data': 'dataSection'
            };
            
            document.getElementById(sectionMap[sectionName]).style.display = 'block';
            event.target.classList.add('active');
            return false;
        }
        
        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            showToast('Profile updated successfully!');
        });
        
        function savePreferences() {
            const personality = document.getElementById('defaultPersonality').value;
            localStorage.setItem('defaultPersonality', personality);
            showToast('Preferences saved!');
        }
        
        function clearHistory() {
            if (confirm('Are you sure you want to clear all your job history?')) {
                localStorage.removeItem('savedJobs');
                localStorage.removeItem('dashboardData');
                showToast('History cleared!');
                setTimeout(() => window.location.reload(), 1500);
            }
        }
        
        function deleteAccount() {
            const confirmation = prompt('Type "DELETE" to confirm account deletion:');
            if (confirmation === 'DELETE') {
                // In production, this would call a Supabase function
                localStorage.clear();
                showToast('Account deleted. Redirecting...');
                setTimeout(() => {
                    logout();
                }, 2000);
            }
        }
    </script>
</body>
</html>
